---
pagination:
  data: clues
  size: 1
  alias: clue
  addAllPagesToCollections: true
permalink: "/clues/{{ clue.id }}/index.html"
layout: base
title: "{{ clue.title }} - Clue"
description: "{% if clue.subtitle %}{{ clue.subtitle }}{% else %}{{ clue.title }}{% endif %} - {% set descText = clue.narrative or clue.appearance or clue.narration or clue.content or '' %}{% if descText %}{{ descText | replace('**', '') | replace('*', '') | replace('#', '') | replace('![', '') | replace(']', '') | replace('(', '') | replace(')', '') | truncate(130) }}{% else %}A clue in The Lost Souls of Kennebec Avenue investigation{% endif %}"
---
<link rel="stylesheet" href="{{ site.baseUrl }}clues/clues.css">
<link rel="stylesheet" href="{{ site.baseUrl }}clues/lock.css">
<link rel="stylesheet" href="{{ site.baseUrl }}clues/progress.css">

<header>
  {% include "clues/progress-tracker.njk" %}
</header>

<main class="clue-page" data-state="locked" data-clue-id="{{ clue.id }}">
  <header>
    <h1>{{ clue.title }}</h1>
    {% if clue.subtitle %}<p class="clue-subtitle">{{ clue.subtitle }}</p>{% endif %}
  </header>

  {# Story gate section - shown when clue belongs to a locked act #}
  {% if clue.act and refs.story_gates[clue.act] %}
  <section class="clue-gate">
    <div class="lock-assembly gated">
      <div class="lock-glow"></div>
      <div class="lock-shackle"></div>
      <div class="lock-body"><div class="keyhole"></div></div>
    </div>
    <p>{{ refs.story_gates[clue.act].gate_message }}</p>
  </section>
  {% endif %}

  {# Skill lock section - shown when player lacks required skills #}
  {% if clue.skills and clue.skills.length %}
  <section class="clue-lock"></section>
  {% endif %}

{% if clue.type and 'Vision' in clue.type and clue.narrative %}
<section class="clue-narration">
  <div>
    {{ clue.narrative | markdown | safe }}
  </div>
</section>
{% elif clue.appearance %}
<section class="clue-narration">
  <div>
    {{ clue.appearance | markdown | safe }}
  </div>
</section>
{% elif clue.narration %}
<section class="clue-narration">
  <div>
    {{ clue.narration | markdown | safe }}
  </div>
</section>
{% endif %}

{% if clue.content %}
<section class="clue-content">
  <div>
    {{ clue.content | markdown | safe }}
  </div>
</section>
{% endif %}

  {# Sign in character display - shown for sign in clues #}
  {% if clue.id == 'SIGN_IN' %}
  <section class="character-callout" id="sign-in-character-display">
    Your character: <strong id="sign-in-character-name">Loading...</strong>
  </section>
  {% endif %}

  {# Technical check display - shown for test clue #}
  {% if clue.id == 'TEST001' %}
  <section id="technical-check-results" class="technical-check">
    <h2>Technical Check Results</h2>
    <div id="check-status" class="check-status">Running checks...</div>
    <ul id="check-results" class="check-results"></ul>
  </section>
  {% endif %}

{% if clue.unlock_code and clue.skills and clue.skills.length > 0 %}
<section class="seance-section">
  <div class="seance-section-label">Show these symbols to others to unlock their clues</div>
  <div class="static-ring" data-unlock-code="{{ clue.unlock_code }}"></div>
</section>
{% endif %}

{% if clue.previous_id or clue.next_id %}
<nav class="page-nav" aria-label="Clue navigation">
  {% if clue.previous_id %}
    <a href="{{ site.baseUrl }}clues/{{ clue.previous_id }}/" class="button" aria-label="Previous clue">← Previous</a>
  {% else %}
    <span></span>
  {% endif %}
  {% if clue.next_id %}
    <a href="{{ site.baseUrl }}clues/{{ clue.next_id }}/" class="button" aria-label="Next clue">Next →</a>
  {% else %}
    <span></span>
  {% endif %}
</nav>
{% endif %}

<script>
  // Pre-compute which characters have access to this clue (build-time optimization)
  {% set accessChars = clue.skills | charactersWithAccess(characters) %}
  
  // Pass data to JavaScript - all build-time computed
  window.__clueData = {{ clue | json | safe }};
  window.__clueData.accessChars = {{ accessChars | json | safe }};
  window.__noAccessMessages = {{ refs.no_access_messages | json | safe }};
  {% if clue.act and refs.story_gates[clue.act] %}
  window.__clueData.gate_message = {{ refs.story_gates[clue.act].gate_message | json | safe }};
  {% endif %}
  {% if clue.id == 'SIGN_IN' %}
  window.__characters = {{ characters | json | safe }};
  {% endif %}
</script>
</main>