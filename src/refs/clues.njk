---
layout: base
title: "Clue Organization"
permalink: refs/clues/
---
<link rel="stylesheet" href="{{ site.baseUrl }}quests/quests.css">
<link rel="stylesheet" href="{{ site.baseUrl }}refs/refs.css">
<header>
  <h1>üìã Clue Organization</h1>
  <p class="italic">All clues and rumors organized by act, filterable by hashtag</p>
  <p><a href="{{ site.baseUrl }}refs/">‚Üê Back to References</a></p>
</header>

{# ---- Table of contents ---- #}
<section>
  <h2>Acts</h2>
  <nav class="reference-links">
    {% for actKey, actData in refs.clue_organization %}
      {% if actData.name %}
        <a href="#{{ actKey }}">{{ actData.name }}</a>
        {% if not loop.last %}<span class="separator">‚Ä¢</span>{% endif %}
      {% endif %}
    {% endfor %}
  </nav>
</section>

{# ---- Act sections ---- #}
{% for actKey, actData in refs.clue_organization %}
{% if actData.name %}
<section class="act-section" id="{{ actKey }}" data-act="{{ actKey }}">
  <h2>{{ actData.name }}</h2>

  {# ---- Tag filter placeholder (populated by JS) ---- #}
  <div class="tag-filters" data-act="{{ actKey }}"></div>

  {# ---- Clues list ---- #}
  {% if actData.clues and actData.clues.length %}
  <h3 class="section-subheader">üîç Clues <span class="item-count clue-count"></span></h3>
  <ul class="clue-list" data-act="{{ actKey }}">
    {% for clueName in actData.clues %}
      {% set clue = clueName | getClue(clues) %}
      {% if clue %}
      <li class="clue-item" data-tags="{{ clue.hashtags | join(',') if clue.hashtags else '' }}">
        <div class="clue-item-main">
          {{ clue.type | typeIcon }}
          <a href="{{ site.baseUrl }}clues/{{ clue.title }}/" target="_blank">{{ clue.title }}</a>
          <span class="muted type-label"> ‚Äî {{ clue.type }}</span>
        </div>
        {% if clue.hashtags %}
        <div class="clue-item-tags">
          {% for tag in clue.hashtags %}
            <span class="tag-badge" data-tag="{{ tag }}">{{ tag | replace("_", " ") }}</span>
          {% endfor %}
        </div>
        {% endif %}
      </li>
      {% endif %}
    {% endfor %}
  </ul>
  {% endif %}

  {# ---- Rumors list ---- #}
  {% if actData.rumors and actData.rumors.length %}
  <h3 class="section-subheader">üí¨ Rumors <span class="item-count rumor-count"></span></h3>
  <ul class="rumor-list" data-act="{{ actKey }}">
    {% for rumorName in actData.rumors %}
      {% set rumor = rumorName | getRumor(rumorsData) %}
      {% if rumor %}
      <li class="rumor-item" data-tags="{{ rumor.hashtags | join(',') if rumor.hashtags else '' }}">
        <div class="rumor-item-main">
          <span class="rumor-content">{{ rumor.content | trim }}</span>
          {% if rumor.truth %}
            <span class="truth-badge truth-true">‚úì TRUE</span>
          {% else %}
            <span class="truth-badge truth-false">‚úó FALSE</span>
          {% endif %}
        </div>
        {% if rumor.hashtags %}
        <div class="clue-item-tags">
          {% for tag in rumor.hashtags %}
            <span class="tag-badge" data-tag="{{ tag }}">{{ tag | replace("_", " ") }}</span>
          {% endfor %}
        </div>
        {% endif %}
      </li>
      {% else %}
      <li class="rumor-item">
        <span class="muted">{{ rumorName }}</span>
      </li>
      {% endif %}
    {% endfor %}
  </ul>
  {% endif %}

  {% if not actData.clues and not actData.rumors %}
    <p class="muted italic">All clues unlocked. Complete narrative can be pieced together from all available evidence.</p>
  {% endif %}

</section>
{% endif %}
{% endfor %}

{% include "reference-footer.njk" %}

<script>
(function() {
  // For each act section, build the tag filter UI dynamically
  document.querySelectorAll('.act-section').forEach(section => {
    const actKey = section.dataset.act;
    const filterContainer = section.querySelector('.tag-filters');
    const items = section.querySelectorAll('.clue-item, .rumor-item');
    const activeTags = new Set();

    // Collect all unique tags from items in this act
    const allTags = new Set();
    items.forEach(item => {
      const tags = (item.dataset.tags || '').split(',').filter(Boolean);
      tags.forEach(t => allTags.add(t));
    });

    if (allTags.size === 0) {
      filterContainer.style.display = 'none';
      return;
    }

    // Build the filter UI
    const sorted = Array.from(allTags).sort();
    filterContainer.innerHTML = '<div class="tag-filter-label">Filter by tag:</div><div class="tag-pills">' +
      sorted.map(tag => '<button class="tag-pill" data-tag="' + tag + '">' + tag.replace(/_/g, ' ') + '</button>').join('') +
      '<button class="tag-pill tag-clear" data-action="clear">‚úï clear</button></div>';

    // Update counts
    updateCounts(section, items.length);

    // Event delegation for tag clicks
    filterContainer.addEventListener('click', function(e) {
      const btn = e.target.closest('.tag-pill');
      if (!btn) return;

      if (btn.dataset.action === 'clear') {
        activeTags.clear();
        filterContainer.querySelectorAll('.tag-pill').forEach(p => p.classList.remove('active'));
      } else {
        const tag = btn.dataset.tag;
        if (activeTags.has(tag)) {
          activeTags.delete(tag);
          btn.classList.remove('active');
        } else {
          activeTags.add(tag);
          btn.classList.add('active');
        }
      }
      filterItems();
    });

    function filterItems() {
      let visibleClues = 0, visibleRumors = 0;

      items.forEach(item => {
        if (activeTags.size === 0) {
          item.style.display = '';
          if (item.classList.contains('clue-item')) visibleClues++;
          if (item.classList.contains('rumor-item')) visibleRumors++;
          return;
        }
        const itemTags = (item.dataset.tags || '').split(',').filter(Boolean);
        const match = itemTags.some(t => activeTags.has(t));
        item.style.display = match ? '' : 'none';
        if (match) {
          if (item.classList.contains('clue-item')) visibleClues++;
          if (item.classList.contains('rumor-item')) visibleRumors++;
        }
      });

      // Highlight matching tag badges
      section.querySelectorAll('.tag-badge').forEach(badge => {
        badge.classList.toggle('highlighted', activeTags.size > 0 && activeTags.has(badge.dataset.tag));
      });

      // Update counts
      const totalClues = section.querySelectorAll('.clue-item').length;
      const totalRumors = section.querySelectorAll('.rumor-item').length;
      updateCounts(section,
        activeTags.size === 0 ? totalClues : visibleClues,
        activeTags.size === 0 ? totalRumors : visibleRumors,
        activeTags.size > 0 ? totalClues : null,
        activeTags.size > 0 ? totalRumors : null
      );
    }
  });

  function updateCounts(section, visClues, visRumors, totalClues, totalRumors) {
    const clueCount = section.querySelector('.clue-count');
    const rumorCount = section.querySelector('.rumor-count');
    if (clueCount) {
      const tc = totalClues || section.querySelectorAll('.clue-item').length;
      clueCount.textContent = totalClues ? '(' + visClues + '/' + tc + ')' : '(' + tc + ')';
    }
    if (rumorCount) {
      const tr = totalRumors || section.querySelectorAll('.rumor-item').length;
      rumorCount.textContent = totalRumors ? '(' + visRumors + '/' + tr + ')' : '(' + tr + ')';
    }
  }
})();
</script>
