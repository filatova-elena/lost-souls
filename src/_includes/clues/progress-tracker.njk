{# Pre-compute progress data at build time #}
{% set mainQuestHashtag = 'main_quest' %}

{# Always calculate main quest total - count ALL clues with main_quest in is_key #}
{% set mainQuestKeyClues = clues | filterKeyClues(mainQuestHashtag) %}
{% set mainQuestTotal = mainQuestKeyClues | length %}

{# Pre-compute side quest totals for each character's side quest #}
{# Build as object directly for efficient JavaScript consumption #}
{% set sideQuests = {} %}
{% for characterId, sideQuestInfo in character_side_quests %}
  {% set sideQuestKeyClues = clues | filterKeyClues(sideQuestInfo.hashtag) %}
  {% set sideQuests = sideQuests | merge(characterId | obj({ hashtag: sideQuestInfo.hashtag, total: sideQuestKeyClues | length, objectiveShort: sideQuestInfo.objectiveShort })) %}
{% endfor %}

{# Output progress data as JSON for JavaScript #}
<script>
  window.__progressData = {
    mainQuestHashtag: {{ mainQuestHashtag | json | safe }},
    mainQuestTotal: {{ mainQuestTotal }},
    sideQuests: {{ sideQuests | json | safe }}
  };
</script>

<div class="progress-tracker" data-progress-tracker>
  <div class="progress-track main" data-quest="main_quest">
    <div class="progress-track-header">
      <span class="progress-label">Main Quest</span>
      <span class="progress-count" data-count>0 / {{ mainQuestTotal }}</span>
    </div>
    <div class="progress-pips" data-pips></div>
  </div>
  
  {# Side quest track will be rendered by JavaScript based on current character #}
  <div class="progress-track side" data-quest="" style="display: none;">
    <div class="progress-track-header">
      <span class="progress-label">Side Quest</span>
      <span class="progress-count" data-count>0 / 0</span>
    </div>
    <div class="progress-pips" data-pips></div>
  </div>
</div>
